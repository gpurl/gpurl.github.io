{"version":3,"sources":["pages/Game/Nipple/index.js","pages/Game/Nipple/styles.module.scss"],"names":["Matter","use","Engine","RenderDom","DomBodies","World","Constraint","Mouse","Events","DomBody","Render","scratching","Nipple","onDone","scratches","useEffect","document","body","style","overflow","cw","clientWidth","ch","clientHeight","scratchesCount","done","engine","create","render","stop","DebugRender","canvas","remove","mapping","ratioMultiplier","element","ctrX","ctrY","nippleSize","querySelector","backNippleOptions","isSensor","isStatic","Dom","backNipple","polygon","nippleBaseOptions","nippleBase","fingerOptions","density","finger","nippleBodyOptions","nippleBody","nippleOptions","nipple","nippleTopOptions","nippleTop","elastic","pointA","x","y","bodyB","stiffness","elastic2","bodyA","mouse","container","on","position","dist","Math","sqrt","pow","height","children","setAttribute","speed","angle","atan2","setAngle","setPosition","add","world","run","clear","context","textures","id","className","css","module","exports"],"mappings":"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","file":"static/js/12.a8c41512.chunk.js","sourcesContent":["import React, { useEffect } from \"react\"\nimport css from \"./styles.module.scss\"\nimport Matter from \"matter-js\"\nimport \"matter-dom-plugin\"\nMatter.use(\"matter-dom-plugin\")\n\nconst { Engine, RenderDom, DomBodies, World, Constraint, Mouse, Events, DomBody, Render } = Matter\n\nlet scratching = false\n\nfunction Nipple({ onDone, scratches = 50 }) {\n  useEffect(() => {\n    document.body.style.overflow = \"hidden\"\n    const cw = document.body.clientWidth\n    const ch = document.body.clientHeight\n    let scratchesCount = 0\n    let done = false\n    const engine = Engine.create()\n    const render = RenderDom.create({ engine })\n    Render.stop(render.DebugRender)\n    render.DebugRender.canvas.remove()\n\n    render.mapping.ratioMultiplier = 1\n\n    const ctrX = cw / 2\n    const ctrY = ch / 2\n\n    const nippleSize = 30\n    var element\n\n    element = document.querySelector(\"#backNipple\")\n    const backNippleOptions = { isSensor: true, isStatic: true, Dom: { render, element } }\n    var backNipple = DomBodies.polygon(ctrX, ctrY, 12, nippleSize * 4, backNippleOptions)\n\n    element = document.querySelector(\"#nippleBase\")\n    var nippleBaseOptions = { isSensor: true, isStatic: true, Dom: { render, element } }\n    var nippleBase = DomBodies.polygon(ctrX, ctrY, 8, nippleSize, nippleBaseOptions)\n\n    element = document.querySelector(\"#finger\")\n    const fingerOptions = { density: 0.02, isStatic: true, Dom: { render, element } }\n    var finger = DomBodies.polygon(0, 0, 4, nippleSize * 1.5, fingerOptions)\n\n    element = document.querySelector(\"#nippleBody\")\n    var nippleBodyOptions = { isSensor: true, isStatic: true, Dom: { render, element } }\n    var nippleBody = DomBodies.polygon(ctrX, ctrY, 8, nippleSize, nippleBodyOptions)\n\n    element = document.querySelector(\"#nipple\")\n    var nippleOptions = { density: 0.004, Dom: { render, element } }\n    var nipple = DomBodies.polygon(ctrX, ctrY, 8, nippleSize, nippleOptions)\n\n    element = document.querySelector(\"#nippleTop\")\n    var nippleTopOptions = { density: 0.004, isSensor: true, Dom: { render, element } }\n    var nippleTop = DomBodies.polygon(ctrX, ctrY, 8, nippleSize, nippleTopOptions)\n\n    var elastic = Constraint.create({ pointA: { x: ctrX, y: ctrY }, bodyB: nipple, stiffness: 0.1 })\n    var elastic2 = Constraint.create({ bodyA: nipple, bodyB: nippleTop, stiffness: 0.1 })\n\n    // add mouse control\n    var mouse = Mouse.create(document.body)\n\n    var container = document.querySelector(\"#container\")\n    Events.on(engine, \"afterUpdate\", function () {\n      if (!mouse.position.x) {\n        return\n      }\n\n      const dist = Math.sqrt(Math.pow(ctrX - nippleTop.position.x, 2) + Math.pow(ctrY - nippleTop.position.y, 2))\n\n      nipple.Dom.element.style.height = 70 - dist / 2 + \"px\"\n      // nipple.Dom.element.style.height = 100 - dist/10 + \"px\"\n      // nippleTop.Dom.element.style.height = 60 - dist/10 + \"px\"\n      nippleTop.Dom.element.style.height = 30 - dist / 2 + \"px\"\n      nippleBody.Dom.element.children[0].style.height = dist + \"px\"\n\n      container.setAttribute(\"fast\", nipple.speed > 3)\n      container.setAttribute(\"stretched\", dist > 40)\n\n      if (nipple.speed > 4) {\n        if (!scratching) {\n          scratching = true\n          scratchesCount++\n        }\n      } else {\n        scratching = false\n      }\n\n      if (scratchesCount >= scratches && !done) {\n        done = true\n        onDone()\n      }\n\n      const angle = -Math.atan2(ctrX - nippleTop.position.x, ctrY - nippleTop.position.y)\n      DomBody.setAngle(nipple, angle)\n      DomBody.setAngle(nippleTop, angle)\n      DomBody.setAngle(nippleBody, angle)\n      DomBody.setPosition(finger, {\n        x: mouse.position.x,\n        y: mouse.position.y,\n      })\n    })\n\n    // keep the mouse in sync with rendering\n    render.mouse = mouse\n\n    World.add(engine.world, [backNipple, nippleBase, nippleBody, nipple, nippleTop, elastic, elastic2, finger])\n\n    Engine.run(engine)\n    RenderDom.run(render)\n\n    return () => {\n      document.body.style.overflow = \"\"\n      RenderDom.stop(render)\n      World.clear(engine.world)\n      Engine.clear(engine)\n      render.canvas = null\n      render.context = null\n      render.textures = {}\n    }\n  }, [onDone, scratches])\n\n  return (\n    <div id=\"container\" className={css.container}>\n      <div id=\"debug\"></div>\n      <div id=\"finger\"></div>\n      <div id=\"backNipple\" className={css.backNipple}></div>\n      <div id=\"nippleBase\" className={css.nippleBase}></div>\n      <div id=\"nippleBody\">\n        <div className={css.nippleBody}></div>\n      </div>\n      <div id=\"nipple\" className={css.nipple}></div>\n      <div id=\"nippleTop\">\n        <div className={css.nippleTop}></div>\n      </div>\n    </div>\n  )\n}\n\nexport default Nipple\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"nippleTop\":\"styles_nippleTop__izCCc\",\"nipple\":\"styles_nipple__T5lSo\",\"container\":\"styles_container__WzJvj\",\"nippleBody\":\"styles_nippleBody__2l9z5\",\"nippleBase\":\"styles_nippleBase__12u59\",\"backNipple\":\"styles_backNipple__3c-Bd\"};"],"sourceRoot":""}